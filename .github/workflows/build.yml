name: Build

on:
  push:
    branches: [ master ]

concurrency:
  group: ${{ github.ref }}
  cancel-in-progress: true

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Generate bitwarden_rs armv7 binaries
      env:
        GJTOKEN: ${{ secrets.GJTOKEN }}
        PRIVATEKEY: ${{ secrets.PRIVATEKEY }}
        PRIVATEKEYCONTENTS: ${{ secrets.PRIVATEKEYCONTENTS }}
      run: |
        echo $PRIVATEKEYCONTENTS > ~/.ssh/$PRIVATEKEY
        echo \
          "host github.com
           HostName github.com
           IdentityFile ~/.ssh/$PRIVATEKEY
           User git" > ~/.ssh/config
        git clone git@github.com:growtopiajaw/bitwarden_rs.git
        cd bitwarden_rs
        bash generate_armv7_binaries.sh

    - name: Get system storage space
      run: |
        df -h
        lsblk
        blkid

    - name: Run neofetch
      run: |
        wget https://github.com/dylanaraps/neofetch/raw/master/neofetch
        bash neofetch

    - name: Get cpuinfo
      run: |
        cat /proc/cpuinfo
        lsb_release -a
        uname -a
